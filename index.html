<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manga Okuyucu</title>
<style>
    /* SİTE TASARIMI */
    body { background-color: #121212; color: #ddd; margin: 0; font-family: sans-serif; }
    .header { background: #222; padding: 15px; text-align: center; position: sticky; top: 0; border-bottom: 3px solid #ff4500; display: flex; justify-content: center; gap: 10px; z-index: 999; }
    select, button { padding: 10px; background: #333; color: white; border: 1px solid #555; border-radius: 5px; cursor: pointer; font-size: 16px; }
    .viewer { max-width: 800px; margin: 0 auto; background: #000; min-height: 100vh; }
    .viewer img { width: 100%; display: block; }
</style>
</head>
<body>

<div class="header">
    <select id="seriesSelect" onchange="bolumleriGetir()">
        <option>Yükleniyor...</option>
    </select>
    <select id="chapterSelect" onchange="resimleriGetir()"></select>
    <button onclick="sonrakiBolum()">Sonraki Bölüm &gt;</button>
</div>

<div class="viewer" id="comicContainer"></div>

<script>
    let ARSIV = {}; 
    const sSelect = document.getElementById('seriesSelect');
    const cSelect = document.getElementById('chapterSelect');
    const viewer = document.getElementById('comicContainer');

    // 1. EXCEL DOSYASINI OKU
    fetch('liste.csv?t=' + Date.now()).then(res => res.text()).then(text => {
        sSelect.innerHTML = ""; 
        text.split('\n').forEach(line => {
            let d = line.split(',').map(x => x.trim());
            if(d.length < 5) return;
            // Excel sırası: İsim, Kullanıcı, Depo, Bölüm, Sayfa
            let [seri, user, repo, bolum, sayfa] = d;
            
            if(!ARSIV[seri]) ARSIV[seri] = { bolumler: {} };
            ARSIV[seri].bolumler[bolum] = { u: user, r: repo, s: parseInt(sayfa) };
        });

        Object.keys(ARSIV).sort().forEach(s => {
            let opt = document.createElement("option");
            opt.text = s; opt.value = s;
            sSelect.add(opt);
        });
        bolumleriGetir();
    });

    // 2. MENÜLERİ AYARLA
    function bolumleriGetir() {
        cSelect.innerHTML = "";
        let seri = sSelect.value;
        if(!ARSIV[seri]) return;
        Object.keys(ARSIV[seri].bolumler).sort((a,b)=>a-b).forEach(b => {
            let opt = document.createElement("option");
            opt.text = "Bölüm " + b; opt.value = b;
            cSelect.add(opt);
        });
        resimleriGetir();
    }

    // 3. RESİMLERİ ÇEK (GARSON SERVİS YAPIYOR)
    function resimleriGetir() {
        viewer.innerHTML = "<h3 style='text-align:center; padding:20px'>Yükleniyor...</h3>";
        window.scrollTo(0,0);
        let seri = sSelect.value;
        let bolum = cSelect.value;
        let veri = ARSIV[seri].bolumler[bolum];

        viewer.innerHTML = "";
        for(let i=1; i<=veri.s; i++) {
            let img = document.createElement("img");
            // Adresi Excel'den gelen bilgiye göre oluştur
            img.src = `https://cdn.jsdelivr.net/gh/${veri.u}/${veri.r}/${seri}/${bolum}/${i.toString().padStart(2,'0')}.jpg`;
            img.loading = "lazy";
            img.onerror = function(){ this.style.display="none"; };
            viewer.appendChild(img);
        }
    }

    function sonrakiBolum() {
        if(cSelect.selectedIndex < cSelect.options.length-1) {
            cSelect.selectedIndex++;
            resimleriGetir();
        } else { alert("Bitti!"); }
    }
</script>
</body>
</html>
