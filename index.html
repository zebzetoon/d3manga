<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manga Okuyucu</title>
<style>
    /* --- TASARIM (DOKUNMA) --- */
    body { background-color: #121212; color: #ddd; margin: 0; font-family: sans-serif; overflow-x: hidden; }
    .header { 
        background: #1f1f1f; padding: 10px; text-align: center; 
        position: sticky; top: 0; z-index: 999; 
        border-bottom: 3px solid #ff4500; 
        display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; 
    }
    select, button { 
        padding: 10px; background: #333; color: white; 
        border: 1px solid #555; border-radius: 5px; 
        font-size: 16px; cursor: pointer; 
    }
    .viewer { max-width: 800px; margin: 0 auto; background: #000; min-height: 100vh; }
    .viewer img { width: 100%; display: block; }
    .loading { text-align: center; padding: 50px; color: #888; }
</style>
</head>
<body>

<div class="header">
    <select id="seriesSelect" onchange="bolumleriGetir()">
        <option>Yükleniyor...</option>
    </select>
    <select id="chapterSelect" onchange="resimleriGetir()"></select>
    <button onclick="sonrakiBolum()">Sonraki Bölüm &gt;</button>
</div>

<div class="viewer" id="comicContainer"></div>

<script>
    // VERİ HAVUZU
    let ARSIV = {}; 
    const sSelect = document.getElementById('seriesSelect');
    const cSelect = document.getElementById('chapterSelect');
    const viewer = document.getElementById('comicContainer');

    // 1. CSV OKUMA (YENİ FORMAT: Seri, Kullanıcı, Repo, Bölüm, Sayfa)
    fetch('liste.csv?t=' + Date.now()) 
        .then(response => response.text())
        .then(text => {
            const lines = text.split('\n');
            sSelect.innerHTML = ""; 

            lines.forEach(line => {
                let data = line.split(',').map(d => d.trim());
                if(data.length < 5) return; // Eksik satır varsa geç

                // YENİ YAPIYI BURADA ÇÖZÜYORUZ
                let [seri, user, repo, bolum, sayfa] = data;

                if(!ARSIV[seri]) ARSIV[seri] = { bolumler: {} };
                
                // Her bölümün kendi özel adresini kaydediyoruz
                ARSIV[seri].bolumler[bolum] = {
                    kullanici: user,
                    repo: repo,
                    sayfaSayisi: parseInt(sayfa)
                };
            });

            // Menüyü Doldur
            Object.keys(ARSIV).sort().forEach(seri => {
                let opt = document.createElement("option");
                opt.text = seri; opt.value = seri;
                sSelect.add(opt);
            });

            bolumleriGetir();
        })
        .catch(err => {
            viewer.innerHTML = "<h3 style='text-align:center; color:red'>liste.csv okunamadı!</h3>";
        });

    // 2. BÖLÜMLERİ GETİR
    function bolumleriGetir() {
        cSelect.innerHTML = "";
        let seri = sSelect.value;
        if(!ARSIV[seri]) return;

        let bolumListesi = Object.keys(ARSIV[seri].bolumler).sort((a,b) => parseInt(a) - parseInt(b));

        bolumListesi.forEach(b => {
            let opt = document.createElement("option");
            opt.text = "Bölüm " + b; opt.value = b;
            cSelect.add(opt);
        });

        resimleriGetir();
    }

    // 3. RESİMLERİ GETİR (ÇOKLU HESAP DESTEKLİ)
    function resimleriGetir() {
        viewer.innerHTML = "<div class='loading'>Sayfalar Yükleniyor...</div>";
        window.scrollTo(0,0);

        let seri = sSelect.value;
        let bolum = cSelect.value;
        
        // O bölümün özel verilerini al (Hangi kullanıcıda? Hangi repoda?)
        let veri = ARSIV[seri].bolumler[bolum]; 
        
        let user = veri.kullanici;
        let repo = veri.repo;
        let sayfaSayisi = veri.sayfaSayisi;

        viewer.innerHTML = ""; 

        for(let i=1; i<=sayfaSayisi; i++) {
            let sayfa = i.toString().padStart(2, '0');
            let img = document.createElement("img");
            
            // DİNAMİK URL OLUŞTURMA
            img.src = `https://cdn.jsdelivr.net/gh/${user}/${repo}/${seri}/${bolum}/${sayfa}.jpg`;
            
            img.loading = "lazy";
            img.onerror = function(){ this.style.display="none"; };
            viewer.appendChild(img);
        }
    }

    function sonrakiBolum() {
        if(cSelect.selectedIndex < cSelect.options.length - 1) {
            cSelect.selectedIndex++;
            resimleriGetir();
        } else {
            alert("Bu serinin son bölümündesiniz.");
        }
    }
</script>

</body>
</html>
